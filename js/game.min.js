let keyStates=[],ship=null,laser=null,arrayAlien=[],moveRightVirus=!0,sizeWindow=0,spaceVirus=0,numberVirus=0,speedVirus=0,removeSizeTop=0,isWin=!1,isLose=!1,isHome=!1,isStart=!1,score=0,timeStartGame=0,numberShoot=0;function initGame(){document.getElementById("game").innerHTML="",document.getElementById("game").classList.remove("hide"),document.getElementById("home-page").classList.add("hide"),document.getElementById("win-page").classList.add("hide"),document.getElementById("lose-page").classList.add("hide"),document.body.classList.remove("full-page"),isWin=!1,isLose=!1,isHome=!1,keyStates=[],moveRightVirus=!0,arrayAlien=[],timeStartGame=(new Date).getTime(),numberShoot=0,initGameWithSizeWindow(),ship=new Sprite("assets/site_internet_vaisseau.png",0,0,"size-ship"),laser=new Sprite("assets/site_internet_laser.png",0,0,"size-laser"),generateVirus(document.body.clientWidth/2-3*spaceVirus),initAllInteraction(),arrayAlien.forEach(e=>e.startAnimation(moveVirus,speedVirus))}function initGameWithSizeWindow(){document.body.clientWidth>=1200?(sizeWindow=1,spaceVirus=70,numberVirus=6,speedVirus=20):document.body.clientWidth>=576?(sizeWindow=2,spaceVirus=55,numberVirus=5,speedVirus=25):(sizeWindow=3,spaceVirus=40,document.getElementById("commande-mobile").classList.remove("hide"),numberVirus=4,speedVirus=30)}function generateVirus(e){for(let t=0;t<spaceVirus*numberVirus;t+=spaceVirus)for(let i=e;i<e+spaceVirus*numberVirus;i+=spaceVirus){let e=new Sprite("assets/site_internet_virus.png",i,t,"size-virus");e.display="block",arrayAlien.push(e)}}function initAllInteraction(){document.addEventListener("keydown",onKeyDown),document.addEventListener("keyup",onKeyUp),document.getElementById("arrow-left").addEventListener("touchstart",function(e){onMouseDownShip(e,"ArrowLeft")},{passive:!1}),document.getElementById("arrow-left").addEventListener("touchend",function(e){onMouseUpShip(e,"ArrowLeft")},{passive:!1}),document.getElementById("arrow-right").addEventListener("touchstart",function(e){onMouseDownShip(e,"ArrowRight")},{passive:!1}),document.getElementById("arrow-right").addEventListener("touchend",function(e){onMouseUpShip(e,"ArrowRight")},{passive:!1}),document.getElementById("shout").addEventListener("touchstart",function(e){shoutTouch(e)},{passive:!1})}function moveVirus(e){moveRightVirus?(e.left+=3,arrayAlien.filter(e=>"none"!==e.display).forEach(t=>{t.left>document.body.clientWidth-e._node.width&&moveRightVirus&&(arrayAlien.forEach(e=>e.top+=spaceVirus),moveRightVirus=!1)})):(e.left-=3,arrayAlien.filter(e=>"none"!==e.display).forEach(e=>{e.left<=0&&!moveRightVirus&&(arrayAlien.forEach(e=>e.top+=spaceVirus),moveRightVirus=!0)})),e.checkCollision(ship)&&(isLose=!0,arrayAlien.filter(e=>"none"!==e.display).forEach(e=>e.stopAnimation()))}function onMouseDownShip(e,t){e.touches.length>1&&(e.preventDefault(),e.stopPropagation()),keyStates[t]=!0}function onMouseUpShip(e,t){e.touches.length>1&&(e.preventDefault(),e.stopPropagation()),keyStates[t]=!1}function shoutTouch(e){e.touches.length>1&&(e.preventDefault(),e.stopPropagation()),shout()}function onKeyDown(e){e.preventDefault(),keyStates[e.key]=!0}function onKeyUp(e){e.preventDefault(),keyStates[e.key]=!1}function reziseAllElement(){ship.display="block",setTopShip(),ship.left=document.body.clientWidth/2-ship._node.width/2}function setTopShip(){removeSizeTop=0,3===sizeWindow&&(removeSizeTop=80),ship.top=window.innerHeight-ship._node.height-10-removeSizeTop}function shout(){"none"===laser.display&&(numberShoot++,laser.display="block",laser.left=ship.left+(ship._node.width-laser._node.width)/2,laser.top=ship.top,laser.startAnimation(moveLaser,6))}function moveLaser(e){e.top-=10,e.top<-40&&(e.stopAnimation(),e.display="none"),arrayAlien.filter(e=>"none"!==e.display).forEach(t=>{t.checkCollision(e)&&(e.stopAnimation(),e.display="none",t.display="none",t.stopAnimation())}),isWin=0===arrayAlien.filter(e=>"none"!==e.display).length}function launchGame(){initGame(),ship._node.onload=function(){reziseAllElement(),window.onresize=function(){reziseWindows()},animate()}}function animate(){isStart=!0,!0===keyStates.ArrowLeft&&(ship.left-=10),!0===keyStates.ArrowRight&&(ship.left+=10),ship.left<0&&(ship.left=0),ship.left>document.body.clientWidth-ship._node.width&&(ship.left=document.body.clientWidth-ship._node.width),!0===keyStates[" "]&&shout(),isWin?(calculScore(),goToPage("win-page")):isLose?goToPage("lose-page"):isHome?goToPage("home-page"):requestAnimationFrame(animate)}function calculScore(){score=0,score+=20*numberVirus,score+=320/numberShoot,score+=320/(((new Date).getTime()-timeStartGame)/100),document.getElementById("score").innerHTML=parseInt(score)}function goToPage(e){document.getElementById("game").classList.add("hide"),document.getElementById("commande-mobile").classList.add("hide"),document.getElementById(e).classList.remove("hide"),document.body.classList.add("full-page"),isStart=!1}function reziseWindows(){isStart&&(ship.left<0&&(ship.left=0),ship.left>document.body.clientWidth-ship._node.width&&(ship.left=document.body.clientWidth-ship._node.width),setTopShip(),document.body.clientWidth>=1200&&1!==sizeWindow?isHome=!0:document.body.clientWidth>=576&&document.body.clientWidth<1200&&2!==sizeWindow?isHome=!0:document.body.clientWidth<576&&3!==sizeWindow&&(isHome=!0))}document.addEventListener("touchstart",e=>{e.touches.length>1&&(e.preventDefault(),e.stopPropagation())},{passive:!1}),document.addEventListener("touchend",e=>{e.touches.length>1&&(e.preventDefault(),e.stopPropagation())},{passive:!1}),document.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;